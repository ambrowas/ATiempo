<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Formulario de Nuevo Ingreso - ATiempo</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" type="image/png" href="assets/favicon.png">
  <style>
    :root {
      --primary-color: #004080;
      --border-outer: 4px solid black;
      --border-inner: 2px solid black;
      --ok: #0f9d58;
      --warn: #f4b400;
      --err: #d93025;
    }

    * { box-sizing: border-box; }
    body { font-family: 'Roboto', sans-serif; background-color: #f4f4f4; line-height: 1.6; margin: 0; padding: 0; }
    .container { max-width: 900px; margin: 30px auto; padding: 30px; background: #fff; border-radius: 8px; border: var(--border-outer); }

    header { text-align: center; margin-bottom: 20px; }
    header img { height: 80px; }
    h1, h2, h3 { color: var(--primary-color); margin: 0 0 10px 0; }

    /* --- Tab System Styles --- */
    .tab-switcher { border-bottom: var(--border-inner); margin-bottom: 20px; display: flex; gap: 8px; flex-wrap: wrap; }
    .tab-link {
      background-color: #f1f1f1;
      border: var(--border-inner);
      border-bottom: none;
      cursor: pointer;
      padding: 10px 20px;
      font-size: 16px;
      font-weight: 700;
      transition: background-color 0.3s;
      border-radius: 6px 6px 0 0;
    }
    .tab-link.active { background-color: var(--primary-color); color: white; }
    .tab-content { display: none; animation: fadeIn 0.5s; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    fieldset { border: var(--border-inner); border-radius: 5px; padding: 20px; margin-top: 20px; }
    legend { font-weight: 700; font-size: 1.2em; color: var(--primary-color); padding: 0 10px; }
    .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
    .form-group { display: flex; flex-direction: column; }
    label { margin-bottom: 5px; font-weight: 700; color: #333; }
    input, select {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
      background: #fff;
    }
    input[readonly] { background: #e9ecef; }

    /* Dynamic List Styles */
    .dynamic-list-container { margin-top: 15px; }
    .dynamic-list-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
    .dynamic-list { border: 1px solid #ddd; padding: 10px; border-radius: 4px; min-height: 40px; }
    .list-item {
      background-color: #f8f9fa;
      padding: 10px;
      margin-bottom: 5px;
      border-radius: 4px;
      display: flex;
      gap: 8px;
      align-items: center;
    }
    .remove-btn { background: #dc3545; color: white; border: none; border-radius: 50%; width: 24px; height: 24px; cursor: pointer; font-weight: bold; line-height: 24px; text-align: center; }
    .plus-btn { background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; padding: 6px 10px; font-weight: 700; }

    .submit-btn {
      width: 100%;
      padding: 15px;
      font-size: 16px;
      background-color: #035917;
      color: white;
      border: 2px solid black;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.3s;
      margin-top: 20px;
      font-weight: 700;
    }
    .submit-btn:disabled { opacity: 0.6; cursor: not-allowed; }

    #form-message { text-align: center; font-weight: bold; margin-top: 20px; min-height: 24px; }

    /* Tiny upload progress */
    .upload-wrap { margin-top: 12px; }
    .upload-status { font-size: 13px; color: #333; margin-bottom: 6px; min-height: 18px; }
    .tiny-progress {
      width: 100%;
      height: 8px;
      background: #eee;
      border: 1px solid #ccc;
      border-radius: 4px;
      overflow: hidden;
      position: relative;
    }
    .tiny-progress-bar {
      width: 0%;
      height: 100%;
      background: linear-gradient(90deg, #1a73e8, #34a853);
      transition: width 0.15s ease;
    }
    .status-ok { color: var(--ok); }
    .status-warn { color: var(--warn); }
    .status-err { color: var(--err); }

    @media (max-width: 560px) {
      .tab-link { font-size: 14px; padding: 8px 12px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <img src="assets/atiempologo.png" alt="Logo Atiempo">
      <h1>Formulario de Registro de Nuevo Empleado</h1>
    </header>

    <form id="newHireForm" novalidate>
      <div class="tab-switcher">
        <button type="button" class="tab-link active" onclick="openTabById('personales')">1. Datos Personales</button>
        <button type="button" class="tab-link"        onclick="openTabById('profesionales')">2. Datos Profesionales</button>
        <button type="button" class="tab-link"        onclick="openTabById('financieros')">3. Datos Financieros</button>
      </div>

      <div id="personales" class="tab-content" style="display:block;">
        <fieldset>
          <legend>Identidad</legend>
          <div class="form-grid">
            <div class="form-group"><label for="nombres">Nombre(s)</label><input type="text" id="nombres" required></div>
            <div class="form-group"><label for="apellidos">Apellido(s)</label><input type="text" id="apellidos" required></div>
            <div class="form-group"><label for="fecha_nacimiento">Fecha de Nacimiento</label><input type="date" id="fecha_nacimiento" required></div>
            <div class="form-group"><label for="sexo">Sexo</label>
              <select id="sexo">
                <option>Masculino</option><option>Femenino</option>
              </select>
            </div>
            <div class="form-group"><label for="estado_civil">Estado Civil</label>
              <select id="estado_civil" required>
                <option value="">Seleccione...</option>
                <option>Soltero/a</option><option>Casado/a</option>
                <option>Separado/a</option><option>Divorciado/a</option><option>Viudo/a</option>
              </select>
            </div>
            <div class="form-group"><label for="dependientes">Nº de Dependientes</label><input type="number" id="dependientes" value="0" min="0" required></div>
            <div class="form-group"><label for="nacionalidad">Nacionalidad</label><input type="text" id="nacionalidad" value="Ecuatoguineana" required></div>
            <div class="form-group"><label for="natural_de">Natural de (Provincia)</label>
              <select id="natural_de" required>
                <option value="">Seleccione...</option>
                <option>Annobón</option><option>Bioko Norte</option><option>Bioko Sur</option>
                <option>Centro Sur</option><option>Kié-Ntem</option><option>Litoral</option><option>Wele-Nzas</option>
              </select>
            </div>
            <div class="form-group"><label for="direccion">Dirección Completa</label><input type="text" id="direccion" required></div>
          </div>
        </fieldset>

        <fieldset>
          <legend>Contacto Personal y Emergencia</legend>
          <div class="form-grid">
            <div class="form-group"><label for="email_personal">Email Personal</label><input type="email" id="email_personal" required></div>
            <div class="form-group"><label for="telefono_personal">Teléfono Personal</label><input type="tel" id="telefono_personal" required></div>
            <div class="form-group"><label for="contacto_emergencia_nombre">Nombre del Contacto de Emergencia</label><input type="text" id="contacto_emergencia_nombre" required></div>
            <div class="form-group"><label for="contacto_emergencia_relacion">Relación</label><input type="text" id="contacto_emergencia_relacion" placeholder="Ej: Esposo/a, Madre..." required></div>
            <div class="form-group"><label for="contacto_emergencia_telefono">Teléfono de Emergencia</label><input type="tel" id="contacto_emergencia_telefono" required></div>
          </div>
        </fieldset>

        <fieldset>
          <legend>Documentos Personales</legend>
          <div class="form-grid">
            <div class="form-group"><label for="foto">Foto de Perfil (tipo carnet)</label><input type="file" id="foto" accept="image/png, image/jpeg" required></div>
            <div class="form-group"><label for="documento_identidad">DIP / Pasaporte</label><input type="file" id="documento_identidad" accept=".pdf,image/*" required></div>
          </div>
        </fieldset>
      </div>

      <div id="profesionales" class="tab-content">
        <fieldset>
          <legend>Contrato</legend>
          <div class="form-grid">
            <div class="form-group"><label for="fecha_incorporacion">Fecha de Incorporación</label><input type="date" id="fecha_incorporacion" required></div>
            <div class="form-group">
              <label for="tipo_contrato">Tipo de Contrato</label>
              <select id="tipo_contrato" required>
                <option>Indefinido</option><option>Temporal</option><option>Prácticas</option>
              </select>
            </div>
            <div class="form-group" id="expiracion_group" style="display:none;">
              <label for="fecha_expiracion">Fecha de Expiración</label><input type="date" id="fecha_expiracion">
            </div>
            <div class="form-group"><label for="contrato_file">Subir Contrato (PDF)</label><input type="file" id="contrato_file" accept=".pdf" required></div>
          </div>
        </fieldset>

        <fieldset>
          <legend>Experiencia y Formación</legend>
          <div class="form-group"><label for="cv_file">Subir Curriculum Vitae (PDF)</label><input type="file" id="cv_file" accept=".pdf" required></div>

          <div class="dynamic-list-container">
            <div class="dynamic-list-header">
              <h3>Titulaciones Académicas</h3>
              <button type="button" class="plus-btn" id="addTitulacionBtn">+</button>
            </div>
            <div id="titulacionesList" class="dynamic-list"></div>
          </div>

          <div class="dynamic-list-container">
            <div class="dynamic-list-header">
              <h3>Experiencia Laboral Previa</h3>
              <button type="button" class="plus-btn" id="addExperienciaBtn">+</button>
            </div>
            <div id="experienciaList" class="dynamic-list"></div>
          </div>

          <div class="form-group"><label for="reconocimientos_file">Subir Reconocimientos / Certificados (PDF)</label><input type="file" id="reconocimientos_file" accept=".pdf"></div>
        </fieldset>
      </div>

      <div id="financieros" class="tab-content">
        <fieldset>
          <legend>Información Financiera</legend>
          <div class="form-grid">
            <div class="form-group"><label for="salario_anual">Salario Bruto Anual</label><input type="number" id="salario_anual" min="0" step="100" required></div>
            <div class="form-group"><label for="salario_mensual">Salario Neto Mensual (Aprox.)</label><input type="text" id="salario_mensual" readonly></div>
            <div class="form-group"><label for="banco">Banco</label>
              <select id="banco" required>
                <option>Bange</option><option>SGBGE</option><option>CCEI Bank</option><option>EcoBank</option><option>BGFI</option>
              </select>
            </div>
            <div class="form-group"><label for="numero_cuenta">Número de Cuenta</label><input type="text" id="numero_cuenta" required></div>
          </div>
        </fieldset>
      </div>

      <!-- Tiny progress + status -->
      <div class="upload-wrap">
        <div id="uploadStatus" class="upload-status"></div>
        <div class="tiny-progress" aria-hidden="true">
          <div id="uploadBar" class="tiny-progress-bar"></div>
        </div>
      </div>

      <button type="button" id="formNavBtn" class="submit-btn">SIGUIENTE</button>
      <p id="form-message"></p>
    </form>
  </div>

  <audio id="successSound" src="assets/success.mp3" preload="auto"></audio>

  <!-- Firebase v8 SDKs (Storage only needed for this page) -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
  <script>
    // Initialize Firebase (same project used elsewhere)
    const firebaseConfig = {
      apiKey: "AIzaSyBTehSBePV6bjKkI_htP6NsU4agckkSOrE",
      authDomain: "atiempo-9f08a.firebaseapp.com",
      projectId: "atiempo-9f08a",
      storageBucket: "atiempo-9f08a.firebasestorage.app",
      messagingSenderId: "221735208077",
      appId: "1:221735208077:web:28a3134fa23bd407a20ec4",
      measurementId: "G-NVPGWJQ9J6"
    };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const storage = firebase.storage();
  </script>

<script>
  // --- 1. INITIALIZATION & STATE MANAGEMENT ---
  let currentTab = 0; // 0: Personales, 1: Profesionales, 2: Financieros
  const form = document.getElementById('newHireForm');
  const navBtn = document.getElementById('formNavBtn');
  const tabLinks = document.querySelectorAll('.tab-link');
  const tabContents = document.querySelectorAll('.tab-content');
  const messageEl = document.getElementById('form-message');
  const uploadStatusEl = document.getElementById('uploadStatus');
  const uploadBarEl = document.getElementById('uploadBar');

  // --- 2. CORE UI & VALIDATION FUNCTIONS ---
  function validateTab(tabIndex) {
    const tab = tabContents[tabIndex];
    const inputs = tab.querySelectorAll('input[required], select[required]');
    let isTabValid = true;
    for (const input of inputs) {
      if (!input.checkValidity()) {
        input.style.borderColor = 'red';
        isTabValid = false;
      } else {
        input.style.borderColor = '#ccc';
      }
    }
    return isTabValid;
  }

  function updateButtonState() {
    form.querySelectorAll('input[required], select[required]').forEach(el => el.style.borderColor = '#ccc');
    if (currentTab < 2) {
      navBtn.textContent = 'SIGUIENTE';
      navBtn.onclick = () => moveToNextTab();
    } else {
      if (validateTab(0) && validateTab(1) && validateTab(2)) {
        navBtn.textContent = 'ENVIAR FORMULARIO PARA APROBACIÓN';
        navBtn.onclick = () => form.requestSubmit();
      } else {
        navBtn.textContent = 'Faltan campos requeridos';
        navBtn.onclick = () => alert('Por favor, revise todas las pestañas y complete los campos marcados en rojo.');
      }
    }
  }

  function moveToNextTab() {
    if (!validateTab(currentTab)) {
      alert('Por favor, complete todos los campos requeridos en esta sección antes de continuar.');
      return;
    }
    if (currentTab < 2) {
      openTabById(currentTab + 1);
    }
  }

  // Accepts either an index or a panel id string
  function openTabById(targetIdOrIndex) {
    let index = -1;
    if (typeof targetIdOrIndex === 'number') {
      index = targetIdOrIndex;
    } else {
      const panel = document.getElementById(String(targetIdOrIndex));
      index = panel ? [...tabContents].indexOf(panel) : 0;
    }

    if (index < 0 || index >= tabContents.length) index = 0;

    tabContents.forEach(p => { if (p) p.style.display = 'none'; });
    tabLinks.forEach(b => b.classList.remove('active'));

    tabContents[index].style.display = 'block';
    if (tabLinks[index]) tabLinks[index].classList.add('active');

    currentTab = index;
    updateButtonState();
    tabContents[index].scrollIntoView({ behavior: 'smooth', block: 'start' });
  }

  // --- 3. DYNAMIC LIST HELPERS ---
  function addListItem(type) {
    const containerId = type === 'titulacion' ? 'titulacionesList' : 'experienciaList';
    const listContainer = document.getElementById(containerId);
    const itemDiv = document.createElement('div');
    itemDiv.className = 'list-item';

    let content = '';
    if (type === 'titulacion') {
      content = `
        <input type="text" placeholder="Título" class="data-titulo" style="flex:2;" required>
        <input type="text" placeholder="Institución" class="data-institucion" style="flex:2;" required>
        <input type="number" placeholder="Año" class="data-ano" style="flex:1;" required min="1950" max="2099">
      `;
    } else {
      content = `
        <input type="text" placeholder="Puesto" class="data-puesto" style="flex:2;" required>
        <input type="text" placeholder="Institución" class="data-institucion" style="flex:2;" required>
        <input type="text" placeholder="Desde-Hasta (Años)" class="data-periodo" style="flex:1;" required>
      `;
    }
    itemDiv.innerHTML = `${content}<button type="button" class="remove-btn" title="Eliminar" onclick="this.parentElement.remove()">-</button>`;
    listContainer.appendChild(itemDiv);
  }

  // --- 4. UPLOAD HELPERS ---
  function setUploadStatus(text, klass = '') {
    uploadStatusEl.textContent = text || '';
    uploadStatusEl.className = `upload-status ${klass}`.trim();
  }
  function setUploadProgress(pct) {
    uploadBarEl.style.width = `${Math.max(0, Math.min(100, pct))}%`;
  }
  function slugify(str) {
    return (str || '').toString()
      .normalize('NFD').replace(/[\u0300-\u036f]/g, '')
      .replace(/[^a-z0-9]+/gi, '-')
      .replace(/^-+|-+$/g, '')
      .toLowerCase()
      .slice(0, 60);
  }

  function uploadWithProgress(ref, file, baseCompleted, totalBytes, onProgress) {
    return new Promise((resolve, reject) => {
      const task = ref.put(file);
      task.on('state_changed',
        snap => {
          const current = baseCompleted + snap.bytesTransferred;
          const pct = totalBytes ? (current / totalBytes) * 100 : 0;
          onProgress(pct);
        },
        err => reject(err),
        async () => {
          const url = await ref.getDownloadURL();
          resolve(url);
        }
      );
    });
  }

  async function uploadAllSelectedFiles(employeeKey) {
    const monthKey = new Date().toISOString().slice(0, 7);
    const prefix = `new_hires/${monthKey}`;
    const files = [
      { el: document.getElementById('foto').files[0] || null, tag: 'foto' },
      { el: document.getElementById('documento_identidad').files[0] || null, tag: 'identidad' },
      { el: document.getElementById('cv_file').files[0] || null, tag: 'cv' },
      { el: document.getElementById('contrato_file').files[0] || null, tag: 'contrato' },
      { el: document.getElementById('reconocimientos_file').files[0] || null, tag: 'reconocimientos' }
    ];

    const present = files.filter(f => !!f.el);
    const totalBytes = present.reduce((acc, f) => acc + (f.el?.size || 0), 0);
    let completedBytes = 0;
    setUploadStatus('Subiendo archivos (0%)…');
    setUploadProgress(0);

    const urls = { fotoUrl: null, identidadUrl: null, cvUrl: null, contratoUrl: null, reconocimientosUrl: null };

    for (let f of files) {
      if (!f.el) continue;
      const ext = (f.el.name.split('.').pop() || 'bin').toLowerCase();
      const ts = new Date().toISOString().replace(/[:.]/g, '');
      const path = `${prefix}/${employeeKey}/${f.tag}-${ts}.${ext}`;
      const ref = storage.ref().child(path);

      const url = await uploadWithProgress(ref, f.el, completedBytes, totalBytes, (pct) => {
        setUploadStatus(`Subiendo archivos (${pct.toFixed(0)}%)…`);
        setUploadProgress(pct);
      });
      completedBytes += f.el.size;

      if (f.tag === 'foto') urls.fotoUrl = url;
      if (f.tag === 'identidad') urls.identidadUrl = url;
      if (f.tag === 'cv') urls.cvUrl = url;
      if (f.tag === 'contrato') urls.contratoUrl = url;
      if (f.tag === 'reconocimientos') urls.reconocimientosUrl = url;
    }
    setUploadStatus('Archivos subidos correctamente.', 'status-ok');
    setUploadProgress(100);
    return urls;
  }

  async function postJsonSafely(url, payload) {
    const resp = await fetch(url, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });
    const ct = resp.headers.get('content-type') || '';
    const raw = await resp.text();
    if (!resp.ok) throw new Error(`HTTP ${resp.status} ${resp.statusText}: ${raw}`);
    return ct.includes('application/json') ? JSON.parse(raw) : { message: raw };
  }

  // --- 5. EVENT LISTENERS ---
  document.addEventListener("DOMContentLoaded", () => {
    openTabById(0);
    document.getElementById('tipo_contrato').addEventListener('change', function () {
      document.getElementById('expiracion_group').style.display = (this.value !== 'Indefinido') ? 'block' : 'none';
    });
    document.getElementById('salario_anual').addEventListener('input', function () {
      const mensualNeto = (Number(this.value || 0) / 12) * 0.80;
      document.getElementById('salario_mensual').value = mensualNeto > 0 ? `~ ${mensualNeto.toFixed(2)}` : '';
    });
    document.getElementById('addTitulacionBtn').addEventListener('click', () => addListItem('titulacion'));
    document.getElementById('addExperienciaBtn').addEventListener('click', () => addListItem('experiencia'));
    form.addEventListener('input', updateButtonState);
  });

  // --- 6. SUBMIT HANDLER ---
  form.addEventListener('submit', async function (e) {
    e.preventDefault();
    messageEl.style.color = '#333';
    messageEl.textContent = 'Preparando envío…';
    navBtn.disabled = true;

    try {
      if (!(validateTab(0) && validateTab(1) && validateTab(2))) {
        throw new Error('Faltan campos requeridos. Revise las pestañas.');
      }

      const titulaciones = Array.from(document.querySelectorAll('#titulacionesList .list-item')).map(item => ({
        titulo: item.querySelector('.data-titulo')?.value || '',
        institucion: item.querySelector('.data-institucion')?.value || '',
        ano: item.querySelector('.data-ano')?.value || ''
      }));
      const experiencia = Array.from(document.querySelectorAll('#experienciaList .list-item')).map(item => ({
        puesto: item.querySelector('.data-puesto')?.value || '',
        institucion: item.querySelector('.data-institucion')?.value || '',
        periodo: item.querySelector('.data-periodo')?.value || ''
      }));

      const nombres = document.getElementById('nombres').value.trim();
      const apellidos = document.getElementById('apellidos').value.trim();
      const employeeKey = `${slugify(`${nombres} ${apellidos}`)}-${Date.now()}`;

      // Upload files first
      setUploadStatus('Iniciando subida…');
      setUploadProgress(0);
      const fileUrls = await uploadAllSelectedFiles(employeeKey);

      const payload = {
        meta: { submission_date: new Date().toISOString(), source: 'registro_empleado.html' },
        personales: {
          nombres,
          apellidos,
          nombre_completo: `${nombres} ${apellidos}`.trim(),
          fecha_nacimiento: document.getElementById('fecha_nacimiento').value,
          sexo: document.getElementById('sexo').value,
          estado_civil: document.getElementById('estado_civil').value,
          dependientes: Number(document.getElementById('dependientes').value || 0),
          nacionalidad: document.getElementById('nacionalidad').value,
          natural_de: document.getElementById('natural_de').value,
          direccion: document.getElementById('direccion').value,
          email_personal: document.getElementById('email_personal').value,
          telefono_personal: document.getElementById('telefono_personal').value,
          contacto_emergencia: {
            nombre: document.getElementById('contacto_emergencia_nombre').value,
            relacion: document.getElementById('contacto_emergencia_relacion').value,
            telefono: document.getElementById('contacto_emergencia_telefono').value
          },
          archivos: {
            foto_url: fileUrls.fotoUrl,
            identidad_url: fileUrls.identidadUrl
          }
        },
        profesionales: {
          fecha_incorporacion: document.getElementById('fecha_incorporacion').value,
          tipo_contrato: document.getElementById('tipo_contrato').value,
          fecha_expiracion: document.getElementById('fecha_expiracion').value || null,
          archivos: {
            cv_url: fileUrls.cvUrl,
            contrato_url: fileUrls.contratoUrl,
            reconocimientos_url: fileUrls.reconocimientosUrl
          },
          titulaciones,
          experiencia
        },
        financieros: {
          salario_bruto_anual: Number(document.getElementById('salario_anual').value || 0),
          salario_neto_mensual_aprox: (document.getElementById('salario_mensual').value || '').replace(/[~\s]/g,''),
          banco: document.getElementById('banco').value,
          numero_cuenta: document.getElementById('numero_cuenta').value
        }
      };

      const baseUrl =
        (location.hostname === 'localhost' || location.hostname === '127.0.0.1')
          ? 'http://127.0.0.1:5001/atiempo-9f08a/us-central1/submitNewHire'
          : 'https://us-central1-atiempo-9f08a.cloudfunctions.net/submitNewHire';

      const result = await postJsonSafely(baseUrl, payload);

      setUploadStatus('Envío completado.', 'status-ok');
      setUploadProgress(100);
      messageEl.style.color = 'green';
      messageEl.textContent = '¡Formulario enviado con éxito!';
      document.getElementById('successSound')?.play().catch(() => {});
      form.reset();
      openTabById(0);
      updateButtonState();
      setUploadProgress(0);
      setUploadStatus('');
    } catch (err) {
      console.error('Submission error:', err);
      setUploadStatus(`Error: ${err.message}`, 'status-err');
      messageEl.style.color = 'red';
      messageEl.textContent = `Error al enviar: ${err.message}`;
    } finally {
      navBtn.disabled = false;
    }
  });
</script>

</body>
</html>
